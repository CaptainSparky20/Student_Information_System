{% extends 'lecturer/base_lecturer.html' %}
{% load static %}

{% block title %}Manage Parents / Guardians{% endblock %}

{% block content_inner %}
<div class="max-w-5xl mx-auto p-8 bg-white/10 rounded-2xl border border-white/20 shadow-lg mt-10">

  <!-- Header & actions -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-bold text-white">Parents / Guardians</h1>
      <p class="text-gray-300 mt-1">
        Student:
        <span class="font-semibold text-white">{{ student.user.full_name }}</span>
        {% if student.class_group %}
          <span class="text-gray-400">‚Äî {{ student.class_group.name }}</span>
        {% endif %}
      </p>
    </div>

    <div class="flex gap-3">
      {% if student.class_group %}
      <a href="{% url 'lecturer:classgroup_student_list' student.class_group.id %}"
         class="px-4 py-2 rounded-lg bg-gray-600 hover:bg-gray-700 text-white">
        Back to Class
      </a>
      {% endif %}
      <a href="{% url 'lecturer:add_parent_details' student.id %}"
         class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white">
        + Add Parent / Guardian
      </a>
    </div>
  </div>

  <!-- List -->
  {% if parents %}
    <div class="space-y-4">
      {% for p in parents %}
        <div class="flex items-center justify-between bg-white/5 border border-white/20 rounded-xl p-4">
          <div class="flex items-center gap-4">
            {% if p.profile_picture %}
              <img src="{{ p.profile_picture.url }}" alt="" class="w-12 h-12 rounded-full object-cover border border-white/20">
            {% else %}
              <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center font-bold text-white">
                {{ p.full_name|default:"P"|first }}
              </div>
            {% endif %}

            <div>
              <div class="text-white font-semibold">
                {{ p.full_name|default:"(No name)" }}
              </div>

              <div class="text-gray-300 text-sm">
                {% with roles=p.get_roles_list %}
                  {% if roles %}{{ roles|join:", " }}{% else %}<span class="italic text-gray-400">Relationship not set</span>{% endif %}
                {% endwith %}
              </div>

              <div class="text-gray-400 text-sm mt-1 space-x-2">
                {% if p.phone_number %}<span>üìû {{ p.phone_number }}</span>{% endif %}
                {% if p.email %}
                  <span>‚úâÔ∏è <a href="mailto:{{ p.email }}" class="underline">{{ p.email }}</a></span>
                {% endif %}
                {% if p.occupation %}<span>‚Ä¢ {{ p.occupation }}</span>{% endif %}
              </div>

              {% if p.address %}
                <div class="text-gray-400 text-xs mt-1">
                  {{ p.address }}
                </div>
              {% endif %}
            </div>
          </div>

          <form method="post" action="{% url 'lecturer:remove_parent' student.id p.id %}">
            {% csrf_token %}
            <button type="submit"
                    class="px-3 py-2 rounded bg-red-600 hover:bg-red-700 text-white text-sm"
                    onclick="return confirm('Remove this parent/guardian from the student?');">
              Remove
            </button>
          </form>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="bg-white/5 border border-white/20 rounded-xl p-6 text-center">
      <p class="text-gray-300">No parents/guardians linked yet.</p>
      <a href="{% url 'lecturer:add_parent_details' student.id %}"
         class="inline-block mt-4 px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white">
        + Add Parent / Guardian
      </a>
    </div>
  {% endif %}

</div>
{% endblock %}

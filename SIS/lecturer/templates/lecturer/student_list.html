{% extends 'lecturer/base_lecturer.html' %}
{% load static %}

{% block title %}Students in {{ classgroup.name }}{% endblock %}

{% block content_inner %}
<div class="max-w-5xl mx-auto p-8 bg-white/10 rounded-2xl border border-white/20 shadow-lg mt-10">
  <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
    <h1 class="text-3xl font-bold text-white mb-2">Students in {{ classgroup.name }}</h1>
    <a href="{% url 'lecturer:export_class_attendance' classgroup.id %}" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition shadow">
      <svg class="inline w-5 h-5 mr-1 -mt-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14m7-7H5"/></svg>
      Export CSV
    </a>
  </div>

  <!-- Search/filter bar -->
  <form method="get" class="mb-6 flex flex-wrap items-center gap-4">
    <input
      type="text"
      name="q"
      value="{{ request.GET.q }}"
      placeholder="Search by name or email..."
      class="px-4 py-2 rounded-lg bg-white/10 text-white border border-white/20 placeholder-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition"
    />
    <button
      type="submit"
      class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition"
    >Search</button>
    <a href="{% url 'lecturer:classgroup_student_list' classgroup.id %}" class="text-sm text-blue-300 hover:underline ml-2">Reset</a>
  </form>

  {% if students %}
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white/5 border border-white/20 rounded-xl text-white">
        <thead class="bg-white/10 text-left text-sm uppercase font-semibold">
          <tr>
            <th class="p-4">#</th>
            <th class="p-4">Profile</th>
            <th class="p-4">Full Name</th>
            <th class="p-4">Email</th>
            <th class="p-4">Class Group(s)</th>
            <th class="p-4">Joined</th>
            <th class="p-4">Status</th>
            <th class="p-4 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
            <tr class="border-t border-white/10 hover:bg-blue-800/10 transition">
              <td class="p-4">{{ forloop.counter }}</td>
              <td class="p-4">
                {% if student.profile_picture %}
                  <img src="{{ student.profile_picture.url }}" alt="Profile"
                       class="w-10 h-10 rounded-full object-cover border-2 border-white/30 shadow-sm" />
                {% else %}
                  <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center border-2 border-white/30 text-white font-bold text-lg">
                    {{ student.user.get_full_name|first|default:"?" }}
                  </div>
                {% endif %}
              </td>
              <td class="p-4 font-medium">{{ student.user.get_full_name }}</td>
              <td class="p-4">
                <a href="mailto:{{ student.user.email }}" class="inline-block bg-blue-800/20 px-2 py-1 rounded text-blue-200 font-mono hover:underline">
                  {{ student.user.email }}
                </a>
              </td>
              <td class="p-4">
                {% with enrollments=student.enrollment_set.all %}
                  {% for enrollment in enrollments %}
                    <span class="inline-block px-2 py-1 rounded bg-blue-900/40 text-blue-100 text-xs mr-1 mb-1">
                      {{ enrollment.class_group.name }}
                    </span>
                  {% empty %}
                    <span class="italic text-gray-400">-</span>
                  {% endfor %}
                {% endwith %}
              </td>
              <td class="p-4">{{ student.user.date_joined|date:"M d, Y" }}</td>
              <td class="p-4">
                {% if student.user.is_active %}
                  <span class="inline-block px-2 py-1 rounded bg-green-700/40 text-green-200 text-xs">Active</span>
                {% else %}
                  <span class="inline-block px-2 py-1 rounded bg-red-700/40 text-red-200 text-xs">Inactive</span>
                {% endif %}
              </td>
              <td class="p-4 text-center flex flex-col gap-2 md:flex-row md:gap-2 justify-center items-center">
                <a href="{% url 'lecturer:student_full_details' student.user.id %}"
                   class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-semibold transition">
                  View
                </a>
                <a href="{% url 'lecturer:student_achievements' student.id %}"
                   class="bg-purple-700 hover:bg-purple-800 text-white px-3 py-1 rounded text-xs font-semibold transition">
                  Achievements
                </a>
                <a href="{% url 'lecturer:take_disciplinary_action' student.id %}"
                   class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-semibold transition">
                  Take Disciplinary Action
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-center py-12 text-gray-300">
      <svg class="w-16 h-16 mx-auto mb-4 text-blue-600/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 9l-6 6M9 9l6 6"/>
      </svg>
      <h3 class="text-2xl font-semibold mb-2">No students found for this class group.</h3>
      <p>Try changing your filter or check enrollment status.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
